{% extends "base.html" %}

{% block head -%}
{{ super() }}
<!-- CSS -->
{% endblock head -%}

{% block content -%}
{% for cat, msg in get_flashed_messages(True) -%}
    <div class="flash {{ cat }}">{{ msg }}</div>
{% endfor %}
<a href="{{ url_for('profile') }}">Назад</a>
<div class="conference-data">
    <div class="data-row">
        <span class="name-row">Название конференции</span>
        <span class="info-row">{{ conference['title'] }}</span>
    </div>
    <div class="data-row">
        <span class="name-row">Описание конференции</span>
        <span class="info-row">{{ conference['description'] }}</span>
    </div>
    <div class="data-row">
        <span class="name-row">Время старта</span>
        <span class="info-row">{{ conference['time_conf'] }}</span>
    </div>
</div>
<br>
<div class="conference-members">
    {% for member in members -%}
    <div class="member-row" id="user{{ loop.index }}">
        <span id="member_lname{{ loop.index }}">{{ member.lastname }}</span>
        <span id="member_fname{{ loop.index }}">{{ member.firstname }}</span>
        <span id="member_email{{ loop.index }}">{{ member.email }}</span>
    </div>
    {% endfor -%}
</div>
<div class="change-form">
    <p>Введите почту пользователя для добавления его в конференцию</p>
    {% include "addmember_form.html" %}
    <hr>
    <p>Введите почту пользователя для удаления его из конференции</p>
    {% include "removemember_form.html" %}
    <p>Удалить конференцию</p>
    <button id="delete_button" onclick="deleteconf()">УДАЛИТЬ</button>
</div>
<script>
    var conference_id = "{{ conference.id_conf }}";
    var back_url = "{{ url_for('profile') }}";
</script>
<script>
    function deleteconf() { 
        if (confirm("Вы уверены?")) {
            let xhr = new XMLHttpRequest();
            let data = JSON.stringify({"on_delete": conference_id})
            xhr.open("DELETE", "/conference/delete", true);
            xhr.setRequestHeader('Content-type','application/json; charset=utf-8');
            xhr.onload = () => {
                let answer = JSON.parse(xhr.responseText);
                if (xhr.readyState == 4 && xhr.status == "200") {
                    if (answer.deleted == true) {
                        window.location = back_url;
                    } else {
                        alert("Конференция не была удалена, перезагрузите страницу");
                    }
                }
            }
            xhr.send(data);
        } else {
            return undefined;
        }
    }
</script>

{% endblock content -%}